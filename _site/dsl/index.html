<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en-us">

  <head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">

  <!-- Enable responsiveness on mobile devices-->
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

  <title>
    
      DSL &middot; Synvert
    
  </title>

  <!-- CSS -->
  <link rel="stylesheet" href="/synvert/css/poole.css">
  <link rel="stylesheet" href="/synvert/css/syntax.css">
  <link rel="stylesheet" href="/synvert/css/hyde.css">
  <link rel="stylesheet" href="/synvert/css/main.css">
  <link rel="stylesheet" href="http://fonts.googleapis.com/css?family=PT+Sans:400,400italic,700|Abril+Fatface">
</head>


  <body>

    <div class="sidebar">
  <div class="container sidebar-sticky">
    <div class="sidebar-about">
      <h1>Synvert</h1>
      <p class="lead">synvert is used to convert ruby code to better syntax.</p>
    </div>

    <ul class="sidebar-nav">
      <li class="sidebar-nav-item"><a href="/synvert/">Home</a></li>
      <li class="sidebar-nav-item"><a href="/synvert/get_started/">Get Started</a></li>
      <li class="sidebar-nav-item"><a href="/synvert/examples/">Examples</a></li>
      <li class="sidebar-nav-item"><a href="/synvert/dsl/">DSL</a></li>
      <li class="sidebar-nav-item"><a href="/synvert/terms/">Terms</a></li>
      <li class="sidebar-nav-item"><a href="/synvert/rules/">Rules</a></li>
      <li class="sidebar-nav-item"><a href="/synvert/write_snippet/">Write Snippet</a></li>
    </ul>

    <p>&copy; <a href="http://xinminlabs.com" target="_blank">Xinmin Labs</a> 2014.
    All rights reserved.</p>
  </div>
</div>


    <div class="content container">
      <div class="page">
  <h1 class="page-title">DSL</h1>
  <p>Synvert provides a simple dsl to define a snippet.</p>
<div class="highlight"><pre><code class="ruby language-ruby" data-lang="ruby"><span class="no">Synvert</span><span class="o">::</span><span class="no">Rewriter</span><span class="o">.</span><span class="n">new</span> <span class="s2">&quot;name&quot;</span> <span class="k">do</span>
  <span class="n">description</span> <span class="s2">&quot;description&quot;</span>

  <span class="n">if_gem</span> <span class="n">gem_name</span><span class="p">,</span> <span class="p">{</span><span class="ss">gte</span><span class="p">:</span> <span class="n">gem_version</span><span class="p">}</span>

  <span class="n">within_file</span> <span class="n">file_pattern</span> <span class="k">do</span>
    <span class="n">within_node</span> <span class="n">rules</span> <span class="k">do</span>
      <span class="n">with_node</span> <span class="n">rules</span> <span class="k">do</span>
        <span class="n">remove</span>
      <span class="k">end</span>
    <span class="k">end</span>
  <span class="k">end</span>

  <span class="n">within_files</span> <span class="n">files_pattern</span> <span class="k">do</span>
    <span class="n">with_node</span> <span class="n">rules</span> <span class="k">do</span>
      <span class="n">unless_exist_node</span> <span class="n">rule</span> <span class="k">do</span>
        <span class="n">insert</span> <span class="n">code</span>
      <span class="k">end</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div>
<h3>describe</h3>

<p>Describe what the snippet does.</p>
<div class="highlight"><pre><code class="ruby language-ruby" data-lang="ruby"><span class="n">description</span> <span class="s1">&#39;descriptin of snippet&#39;</span>
</code></pre></div>
<h3>if_gem</h3>

<p>Checks the gem in <code>Gemfile.lock</code>, if gem version in <code>Gemfile.lock</code>
is less than, greater than or equal to the version in <code>if_gem</code>,
the snippet will be executed, otherwise, the snippet will be ignored.</p>
<div class="highlight"><pre><code class="ruby language-ruby" data-lang="ruby"><span class="n">if_gem</span> <span class="s1">&#39;factory_girl&#39;</span><span class="p">,</span> <span class="p">{</span><span class="ss">eq</span><span class="p">:</span> <span class="s1">&#39;2.0.0&#39;</span><span class="p">}</span>
<span class="n">if_gem</span> <span class="s1">&#39;factory_girl&#39;</span><span class="p">,</span> <span class="p">{</span><span class="ss">ne</span><span class="p">:</span> <span class="s1">&#39;2.0.0&#39;</span><span class="p">}</span>
<span class="n">if_gem</span> <span class="s1">&#39;factory_girl&#39;</span><span class="p">,</span> <span class="p">{</span><span class="ss">gt</span><span class="p">:</span> <span class="s1">&#39;2.0.0&#39;</span><span class="p">}</span>
<span class="n">if_gem</span> <span class="s1">&#39;factory_girl&#39;</span><span class="p">,</span> <span class="p">{</span><span class="ss">lt</span><span class="p">:</span> <span class="s1">&#39;2.0.0&#39;</span><span class="p">}</span>
<span class="n">if_gem</span> <span class="s1">&#39;factory_girl&#39;</span><span class="p">,</span> <span class="p">{</span><span class="ss">gte</span><span class="p">:</span> <span class="s1">&#39;2.0.0&#39;</span><span class="p">}</span>
<span class="n">if_gem</span> <span class="s1">&#39;factory_girl&#39;</span><span class="p">,</span> <span class="p">{</span><span class="ss">lte</span><span class="p">:</span> <span class="s1">&#39;2.0.0&#39;</span><span class="p">}</span>
</code></pre></div>
<h3>add_file</h3>

<p>Add a new file and write content.</p>
<div class="highlight"><pre><code class="ruby language-ruby" data-lang="ruby"><span class="n">content</span> <span class="o">=&lt;&lt;-</span> <span class="no">EOF</span>
<span class="no">ActiveSupport</span><span class="o">.</span><span class="n">on_load</span><span class="p">(</span><span class="ss">:action_controller</span><span class="p">)</span> <span class="k">do</span>
  <span class="n">wrap_parameters</span> <span class="nb">format</span><span class="p">:</span> <span class="o">[</span><span class="ss">:json</span><span class="o">]</span>
<span class="k">end</span>
<span class="no">EOF</span>
<span class="n">add_file</span> <span class="s1">&#39;config/initializers/wrap_parameters.rb&#39;</span><span class="p">,</span> <span class="n">content</span><span class="o">.</span><span class="n">strip</span>
</code></pre></div>
<h3>remove_file</h3>

<p>Remove a file.</p>
<div class="highlight"><pre><code class="ruby language-ruby" data-lang="ruby"><span class="n">remove_file</span> <span class="s1">&#39;config/initiliazers/secret_token.rb&#39;</span>
</code></pre></div>
<h3>within_file / within_files</h3>

<p>Find files according to file pattern, the block will be executed
only for the matching files.</p>
<div class="highlight"><pre><code class="ruby language-ruby" data-lang="ruby"><span class="n">within_file</span> <span class="s1">&#39;spec/spec_helper.rb&#39;</span> <span class="k">do</span>
  <span class="c1"># find nodes</span>
  <span class="c1"># check nodes</span>
  <span class="c1"># add / replace / remove code</span>
<span class="k">end</span>
</code></pre></div><div class="highlight"><pre><code class="ruby language-ruby" data-lang="ruby"><span class="n">within_files</span> <span class="s1">&#39;spec/**/*_spec.rb&#39;</span> <span class="k">do</span>
  <span class="c1"># find nodes</span>
  <span class="c1"># check nodes</span>
  <span class="c1"># add / replace / remove code</span>
<span class="k">end</span>
</code></pre></div>
<h3>with_node / within_node</h3>

<p>Find ast nodes according to the <a href="/rules/">rules</a>, the block will be executed
for the matching nodes.</p>
<div class="highlight"><pre><code class="ruby language-ruby" data-lang="ruby"><span class="n">with_node</span> <span class="ss">type</span><span class="p">:</span> <span class="s1">&#39;send&#39;</span><span class="p">,</span> <span class="s1">&#39;receiver: &#39;</span><span class="no">FactoryGirl</span><span class="s1">&#39;, message: &#39;</span><span class="n">create</span><span class="err">&#39;</span> <span class="k">do</span>
  <span class="c1"># check nodes</span>
  <span class="c1"># add / replace / remove code</span>
<span class="k">end</span>
</code></pre></div><div class="highlight"><pre><code class="ruby language-ruby" data-lang="ruby"><span class="n">within_node</span> <span class="ss">type</span><span class="p">:</span> <span class="s1">&#39;class&#39;</span><span class="p">,</span> <span class="nb">name</span><span class="p">:</span> <span class="s1">&#39;Test::Unit::TestCase&#39;</span> <span class="k">do</span>
  <span class="c1"># find child nodes</span>
  <span class="c1"># check nodes</span>
  <span class="c1"># add / replace / remove code</span>
<span class="k">end</span>
</code></pre></div>
<h3>goto_node</h3>

<p>Go to the specified child code.</p>
<div class="highlight"><pre><code class="ruby language-ruby" data-lang="ruby"><span class="n">with_node</span> <span class="ss">type</span><span class="p">:</span> <span class="s1">&#39;block&#39;</span> <span class="k">do</span>
  <span class="n">goto_node</span> <span class="ss">:caller</span> <span class="k">do</span>
    <span class="c1"># change code in block caller</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div>
<h3>if_exist_node</h3>

<p>Check if the node matches <a href="/rules/">rules</a> exists, if matches, then executes
the block.</p>
<div class="highlight"><pre><code class="ruby language-ruby" data-lang="ruby"><span class="n">if_exist_node</span> <span class="ss">type</span><span class="p">:</span> <span class="s1">&#39;send&#39;</span><span class="p">,</span> <span class="ss">receiver</span><span class="p">:</span> <span class="s1">&#39;params&#39;</span><span class="p">,</span> <span class="ss">message</span><span class="p">:</span> <span class="s1">&#39;[]&#39;</span> <span class="k">do</span>
  <span class="c1"># add / replace / remove code</span>
<span class="k">end</span>
</code></pre></div>
<h3>unless_exist_node</h3>

<p>Check if the node matches <a href="/rules/">rules</a> does not exist, if does not match,
then executes the block.</p>
<div class="highlight"><pre><code class="ruby language-ruby" data-lang="ruby"><span class="n">unless_exist_node</span> <span class="ss">type</span><span class="p">:</span> <span class="s1">&#39;send&#39;</span><span class="p">,</span> <span class="ss">message</span><span class="p">:</span> <span class="s1">&#39;include&#39;</span><span class="p">,</span> <span class="ss">arguments</span><span class="p">:</span> <span class="o">[</span><span class="s1">&#39;FactoryGirl::Syntax::Methods&#39;</span><span class="o">]</span> <span class="k">do</span>
  <span class="c1"># add / replace / remove code</span>
<span class="k">end</span>
</code></pre></div>
<h3>if_noly_exist_node</h3>

<p>Check if the current node contains only one child node and the child
node matches <a href="/rules/">rules</a>, if matches, then executes the node.</p>
<div class="highlight"><pre><code class="ruby language-ruby" data-lang="ruby"><span class="n">if_only_exist_node</span> <span class="ss">type</span><span class="p">:</span> <span class="s1">&#39;send&#39;</span><span class="p">,</span> <span class="ss">receiver</span><span class="p">:</span> <span class="s1">&#39;self&#39;</span><span class="p">,</span> <span class="ss">message</span><span class="p">:</span> <span class="s1">&#39;include_root_in_json=&#39;</span><span class="p">,</span> <span class="ss">arguments</span><span class="p">:</span> <span class="o">[</span><span class="kp">false</span><span class="o">]</span> <span class="k">do</span>
  <span class="c1"># add / replace / remove code</span>
<span class="k">end</span>
</code></pre></div>
<h3>append</h3>

<p>Add the code at the bottom of the current node body.</p>
<div class="highlight"><pre><code class="ruby language-ruby" data-lang="ruby"><span class="n">append</span> <span class="s1">&#39;config.eager_load = false&#39;</span>
</code></pre></div>
<h3>insert</h3>

<p>Add the code at the top of the current node body.</p>
<div class="highlight"><pre><code class="ruby language-ruby" data-lang="ruby"><span class="n">insert</span> <span class="s2">&quot;include FactoryGirl::Syntax::Methods&quot;</span>
</code></pre></div>
<h3>insert_after</h3>

<p>Add the code next to the current node.</p>
<div class="highlight"><pre><code class="ruby language-ruby" data-lang="ruby"><span class="n">secret</span> <span class="o">=</span> <span class="no">SecureRandom</span><span class="o">.</span><span class="n">hex</span><span class="p">(</span><span class="mi">64</span><span class="p">)</span>
<span class="n">insert_after</span> <span class="s2">&quot;{{receiver}}.secret_key_base = &#39;</span><span class="si">#{</span><span class="n">secret</span><span class="si">}</span><span class="s2">&#39;&quot;</span>
</code></pre></div>
<h3>replace_with</h3>

<p>Replace the current node with the code.</p>
<div class="highlight"><pre><code class="ruby language-ruby" data-lang="ruby"><span class="n">replace_with</span> <span class="s2">&quot;create({{arguments}})&quot;</span>
</code></pre></div>
<h3>remove</h3>

<p>Remove the current node.</p>
<div class="highlight"><pre><code class="ruby language-ruby" data-lang="ruby"><span class="n">with_node</span> <span class="ss">type</span><span class="p">:</span> <span class="s1">&#39;send&#39;</span><span class="p">,</span> <span class="ss">message</span><span class="p">:</span> <span class="s1">&#39;rename_index&#39;</span> <span class="k">do</span>
  <span class="n">remove</span>
<span class="k">end</span>
</code></pre></div>
<h3>replace_erb_stmt_with_expr</h3>

<p>Replace erb statemet code with expression code.</p>
<div class="highlight"><pre><code class="ruby language-ruby" data-lang="ruby"><span class="n">with_node</span> <span class="ss">type</span><span class="p">:</span> <span class="s1">&#39;block&#39;</span><span class="p">,</span> <span class="nb">caller</span><span class="p">:</span> <span class="p">{</span><span class="ss">type</span><span class="p">:</span> <span class="s1">&#39;send&#39;</span><span class="p">,</span> <span class="ss">receiver</span><span class="p">:</span> <span class="kp">nil</span><span class="p">,</span> <span class="ss">message</span><span class="p">:</span> <span class="s1">&#39;form_for&#39;</span><span class="p">}</span> <span class="k">do</span>
  <span class="n">replace_erb_stmt_with_expr</span>
<span class="k">end</span>
</code></pre></div>
<h3>warn</h3>

<p>Don&#39;t change any code, but will give a warning message.</p>
<div class="highlight"><pre><code class="ruby language-ruby" data-lang="ruby"><span class="nb">warn</span> <span class="s1">&#39;Using a return statement in an inline callback block causes a LocalJumpError to be raised when the callback is executed.&#39;</span>
</code></pre></div>
<h3>add_snippet</h3>

<p>Add other snippet, it&#39;s easy to reuse other snippets.</p>
<div class="highlight"><pre><code class="ruby language-ruby" data-lang="ruby"><span class="n">add_snippet</span> <span class="s1">&#39;rails&#39;</span><span class="p">,</span> <span class="s1">&#39;convert_dynamic_finders&#39;</span>
</code></pre></div>
<h3>helper_method</h3>

<p>Add a method which is available in the current snippet.</p>
<div class="highlight"><pre><code class="ruby language-ruby" data-lang="ruby"><span class="n">helper_method</span> <span class="ss">:method1</span> <span class="k">do</span> <span class="o">|</span><span class="n">arg1</span><span class="p">,</span> <span class="n">arg2</span><span class="o">|</span>
  <span class="c1"># do anything you want</span>
<span class="k">end</span>

<span class="n">method1</span><span class="p">(</span><span class="n">arg1</span><span class="p">,</span> <span class="n">arg2</span><span class="p">)</span>
</code></pre></div>
<h3>todo</h3>

<p>List somethings the snippet should do, but not do yet.</p>
<div class="highlight"><pre><code class="ruby language-ruby" data-lang="ruby"><span class="n">todo</span> <span class="o">&lt;&lt;-</span><span class="no">EOF</span>
<span class="sh">Rails 4.0 no longer supports loading plugins from vendor/plugins. You</span>
<span class="sh">must replace any plugins by extracting them to gems and adding them to</span>
<span class="sh">your Gemfile. If you choose not to make them gems, you can move them</span>
<span class="sh">into, say, lib/my_plugin/* and add an appropriate initializer in</span>
<span class="sh">config/initializers/my_plugin.rb.</span>
<span class="no">EOF</span>
</code></pre></div>
</div>

    </div>

    <script>
  window.twttr = (function (d,s,id) {
    var t, js, fjs = d.getElementsByTagName(s)[0];
    if (d.getElementById(id)) return; js=d.createElement(s); js.id=id; js.async=1;
    js.src="https://platform.twitter.com/widgets.js"; fjs.parentNode.insertBefore(js, fjs);
    return window.twttr || (t = { _e: [], ready: function(f){ t._e.push(f) } });
  }(document, "script", "twitter-wjs"));
</script>

<script type="text/javascript">
  var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
  document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
</script>
<script type="text/javascript">
  try {
    var pageTracker = _gat._getTracker("UA-49054619-1");
    pageTracker._trackPageview();
  } catch(err) {}
</script>

  </body>
</html>
